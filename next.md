# NextJS 学习笔记

## -1. 前端基础渲染模式

CSR、SSR、同构、SSG、ISG



### 客户端渲染（CSR）

常见的前端框架像 `React` 、`Vue` 等都是 `CSR` ，将网页的渲染过程从服务器端移至客户端浏览器执行，整个项目打包结果均为静态文件，且通常只有一个 html 文件，该文档只包含基本的骨架结构，通过浏览器下载和执行 `JavaScript` 代码，通过与服务器进行数据交互，动态地生成和更新页面的内容。

但 `CSR` 也有一些问题：

- SEO

- 在组件树首次渲染完之前，页面上无法展示任何内容，且低端设备上 JS 执行效率低，白屏时间长。
- 数据请求必须等到所属组件开始渲染才能发出去，弱网环境下数据返回慢，loading 时间长。



### 服务端渲染（SSR）

早期解决方案像 `PHP` 、`JSP` 等就是服务端渲染，将网页的渲染过程完全或部分地在服务器端执行，当用户访问一个网页时，服务器会根据请求动态生成完整的HTML文档，包括页面的内容和结构，然后将生成的HTML发送给客户端浏览器进行显示。

早期这种技术有一些局限性：

- 较少的动态交互性：由于页面的渲染过程在服务器端完成，客户端浏览器接收到的HTML文档是静态的，限制了一些动态交互功能。
- 对服务器的压力较大：由于每次请求都需要服务器进行渲染和生成HTML文档，对服务器的计算资源和性能要求较高。

针对此提出了动静分离与前后端分层，也即之前提到的 `CSR` ，自此进入了 `CSR` 的黄金时代。但随着技术的不断精进，这些问题好像也不那么棘手了，反而 `CSR` 的问题更让人难以接受，故 `SSR` 有东山再起之势。



### 同构渲染

首屏 SSR，其他界面 CSR，可以在保留了 CSR 几乎所有优点的同时，解决首页白屏的问题，但还是无法解决 SEO 的问题。我之前写小项目的时候用过这种方案，但不知道这就是同构渲染，同时还要在首页 SSR 的同时在后台加载 CSR 项目，比较麻烦。



### NextJS 中的渲染模式

还在看





## 0. 创建 demo

构建 `nextjs` 项目 `npx create-next-app`

从 `package.jaon` 中可以看到，启动命令是 `npm run dev` ，而 `npm run start` 则是生产环境的运行。因为 `react` 打包之后生成的全是静态文件，所以不需要有额外的生产环境命令。若要让 `nextjs` 也生成纯静态文件，则需要在 `package.json` 中额外加一条 `script` ：`"export": "next export",` ，但一定要确保网站是全静态且页面全部是可预生成的。



## 1. 目录结构

Next 13 更新了目录结构，由原来的 pages 目录模式变为了 app 目录模式，由于我是从 13 开始学习的，故不讨论两者的优劣，直接使用 app 目录模式。



### 约定页面相关内容

约定了每一个页面都需要有一个单独的目录，目录下约定了一些文件，均不需要手动引用，next 会按照约定读取：

- `page.tsx` - 页面组件，类似 index.tsx。有 page.tsx 才能表明该路由是一个页面。
- `layout.tsx` - 布局组件，切换路由时保留状态，不重新渲染。
- `template.tsx` - 模版组件，和 `layout` 类似，但切换路由时会重新渲染，不保留状态。
- `loading.tsx` - 加载组件，就是使用 `Suspense` 组件包裹 `Page` 组件，在 `Page` 组件渲染返回内容之前显示加载组件。
- `error.tsx` - 错误文件，页面渲染异常的时候显示的组件。
- `not-found.tsx` - 页面 404 组件，只在 `app` 目录下第一级目录生效，存在时只有根 `layout` 生效。

一个常规的包含二级路由的目录结构如下：

```tree
app
├── MlTest
│   ├── M2Test
│   │   └── page.tsx
│   ├── layout.tsx
│   ├── template.tsx
│   ├── loading.tsx
│   └── error.tsx
├── page.tsx
├── layout.tsx
├── template.tsx
├── loading.tsx
├── error.tsx
└── not-found.tsx
```

此时进入 `/`、`/MlTest/M2Test` 均可看到相应界面，而 `/MlTest` 则会返回 404 页面，也即 app 下的 not-found.tsx 组件。



### 平行路由和插槽功能













> 参考资料：
>
> [SSR 与当年的 JSP、PHP 有什么区别？](https://segmentfault.com/a/1190000037793694)
>
> [鱼和熊掌兼得：Next.js 混合渲染](https://segmentfault.com/a/1190000039111126)
>
> [Next.js之前端渲染模式](https://juejin.cn/post/7160279477690466335)
>
> [Next.js 13 的 app 目录模式功能梳理](https://juejin.cn/post/7221162775074734135)